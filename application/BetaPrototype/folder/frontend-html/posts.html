<!DOCTYPE html>
<html lang="en">
<head>
  <title>Java</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .header {
      background-color: #62b4c9;
      padding: 5px;
      text-align: center;
      font-size: 20px;
      color: white;
      position: relative;
    }

    .logo {
      position: absolute;
      top: 5px;
      left: 5px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .header .brand {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
    }

    .login-signup {
      position: absolute;
      top: 40px;
      right: 10px;
      font-size: 14px;
    }

    .login-signup a {
      color: white;
      text-decoration: none;
      margin: 0 5px;
    }

    .login-signup a:hover {
      text-decoration: underline;
    }

    .search-container {
      position: absolute;
      top: 70px;
      right: 10px;
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    .search-container input[type="text"] {
      padding: 5px;
      border: 1px solid #ccc;
      border-right: none;
      border-radius: 4px 0 0 4px;
    }

    .search-container button {
      padding: 5px;
      border: 1px solid #ccc;
      color: white;
      cursor: pointer;
      border-radius: 0 4px 4px 0;
    }

    .search-container button:hover {
      background-color: #000000;
    }

    .header a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
    }

    .header a:hover {
      text-decoration: underline;
    }

    .icon-button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 0;
      margin: 0 10px;
      font-size: 18px;
      display: inline-block;
      vertical-align: middle;
    }

    .icon-button svg {
      width: 24px;
      height: 24px;
      vertical-align: middle;
    }

    .container {
      display: flex;
      justify-content: center;
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }

    .content {
      flex: 3;
      padding: 0 20px;
    }

    .sidebar {
      flex: 1;
      padding: 0 20px;
    }

    .post {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .post-voting {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-right: 15px;
    }

    .post-voting button {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }

    .post-voting .vote-count {
      font-size: 16px;
    }

    .post-content h3 {
      margin: 0 0 10px;
      font-size: 20px;
    }

    .post-content p {
      margin: 0;
      color: #555;
    }

    .post-footer {
      margin-top: 10px;
      font-size: 14px;
      color: #999;
    }

    .post-footer a {
      color: #007bff;
      text-decoration: none;
    }

    .post-footer a:hover {
      text-decoration: underline;
    }

    .post-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .post-actions button {
      background: none;
      border: none;
      color: #007bff;
      cursor: pointer;
    }

    section {
      margin-bottom: 20px;
    }

    section h3 {
      margin-bottom: 10px;
      font-size: 18px;
    }

    section ul {
      list-style: none;
      padding: 0;
    }

    section ul li {
      margin-bottom: 5px;
    }

    section ul li a {
      color: rgb(43, 72, 31);
      font-size: 16px;
      font-weight: bold;
      text-decoration: none;
    }

    section ul li a:hover {
      text-decoration: underline;
    }

    .create-post-button, .create-group-button {
      display: block;
      width: 200px;
      margin: 20px auto;
      padding: 10px;
      background-color: #007bff;
      color: white;
      text-align: center;
      border-radius: 5px;
      text-decoration: none;
      font-size: 1.2em;
    }

    .create-post-button:hover, .create-group-button:hover {
      background-color: #0056b3;
    }

    footer {
      width: 100%;
      background-color: #62b4c9;
      color: white;
      padding: 10px 0;
      text-align: center;
      margin-top: auto;
    }

    .footer-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .media-icons {
      margin: 10px 0;
    }

    .media-icons a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
    }

    .footer-nav ul {
      list-style: none;
      padding: 0;
      display: flex;
      justify-content: center;
      margin: 0;
    }

    .footer-nav li {
      margin: 0 15px;
    }

    .footer-nav a {
      color: white;
      text-decoration: none;
    }

    .footer-nav a:hover {
      text-decoration: underline;
    }

    .footer-bott {
      margin-top: 10px;
    }

    .reply-section {
      margin-top: 20px;
    }

    .reply {
      margin-left: 20px;
      padding: 10px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .reply .author {
      font-size: 14px;
      color: #999;
    }

    .reply .timestamp {
      font-size: 14px;
      color: #999;
    }

    .reply .reply-content {
      font-size: 16px;
      line-height: 1.5;
    }

    .reply-footer {
      display: flex;
      align-items: center;
    }

    .reply-footer .vote-count {
      margin-left: 10px;
      font-size: 16px;
    }

    .reply-footer button {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }

    .reply-footer .reply-actions {
      margin-left: auto;
      display: flex;
      gap: 10px;
    }

    .reply-footer .reply-actions button {
      background: none;
      border: none;
      color: #007bff;
      cursor: pointer;
    }

    .reply-input {
      display: flex;
      flex-direction: column;
      margin-top: 10px;
    }

    .reply-input textarea {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      resize: vertical;
    }

    .reply-input button {
      align-self: flex-end;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .reply-input button:hover {
      background-color: #0056b3;
    }

    .show-replies {
      cursor: pointer;
      color: #007bff;
      text-decoration: underline;
    }

    .show-replies:hover {
      text-decoration: none;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

<div class="header">
  <img src="Logo.jpg" alt="Logo" class="logo">
  <div class="brand">CodeConnect</div>
  <div class="login-signup">
    <a href="profile.html">Profile</a>
    <a href="login.html">Sign Out</a>
  </div>
  <h2>CodeConverse - Java</h2>
  <a href="homepage.html">Home</a>
  <a href="challenges.html">Challenges</a>
  <a href="mentors.html">Mentors</a>
  <a href="forum.html">Forums</a>
  <a href="store.html">Memberships</a>
  <a href="premium.html">Premium</a>
  <a href="explore.html">Explore</a>
  <a href="workspace.html">Workspaces</a>
  <a href="leaderboards.html">Leaderboards</a>
  <a href="jobs.html">Jobs</a>
  <a href="inbox.html" class="icon-button">
    <svg
      class="mail-icon"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M4 4h16v16H4z" />
      <path d="M4 4l8 8 8-8" />
    </svg>
  </a>

  <a href="profile.html" class="icon-button">
    <svg
      class="profile-icon"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path
        d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v2h20v-2c0-3.3-6.7-5-10-5z"
      />
    </svg>
  </a>

  <button class="icon-button" onclick="openSidebar()">Friends</button>
</div>

<script>
  function openSidebar() {
    document.getElementById("mySidebar").style.width = "250px";
  }

  function closeSidebar() {
    document.getElementById("mySidebar").style.width = "0";
  }
</script>

<div class="container">
  <div class="content" id="postsSection">
    
    </div>
  </div>

  <div class="sidebar">
    <section>
      <h3>Topics</h3>
      <ul>
        <li><a href="topic1.html">Java</a></li>
        <li><a href="topic2.html">MySQL</a></li>
        <li><a href="topic3.html">React</a></li>
        <li><a href="topic4.html">C++</a></li>
        <li><a href="topic5.html">JavaScript</a></li>
      </ul>
    </section>
   
    <section id="myGroupsSection" style="display:none;">
        <h3>My Groups</h3>
        <ul id="myGroupsList">
          <!-- Groups will be dynamically added here -->
        </ul>
      <a href="creategroup.html" class="create-group-button">Create Group</a>
  </section>
  <a href="createpost.html" class="create-post-button">Create Post</a>
    </section>
  </div>
</div>

<script>
  let votedPosts = {};

  function vote(button, value) {
    const post = button.closest('.post, .reply');
    const voteCountElement = button.nextElementSibling || button.previousElementSibling;
    let voteCount = parseInt(voteCountElement.textContent);
    voteCount += value;
    voteCountElement.textContent = voteCount;
  }
// Sample data for user groups
const userGroups = [
    { name: "", link: "" },
    { name: "", link: "" },
  ];

  // Populate the My Groups section dynamically
  document.addEventListener("DOMContentLoaded", () => {
    const myGroupsSection = document.getElementById("myGroupsSection");
    const myGroupsList = document.getElementById("myGroupsList");

    if (userGroups.length > 0) {
      userGroups.forEach(group => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = group.link;
        a.textContent = group.name;
        li.appendChild(a);
        myGroupsList.appendChild(li);
      });
      myGroupsSection.style.display = "block";
      // Get Posts from backend
      getPosts();
    }
    
  });
  function toggleReplies(button) {
    const replySection = button.nextElementSibling;
    if (replySection.style.display === "none" || replySection.style.display === "") {
      replySection.style.display = "block";
      button.textContent = "Hide Replies";
    } else {
      replySection.style.display = "none";
      button.textContent = "Show Replies";
    }
  }

  function sortReplies(select) {
    const sortBy = select.value;
    const replySections = document.querySelectorAll('.reply-section');
    replySections.forEach((section) => {
      const replies = Array.from(section.querySelectorAll('.reply')).sort((a, b) => {
        const timestampA = new Date(a.dataset.timestamp);
        const timestampB = new Date(b.dataset.timestamp);
        const voteCountA = parseInt(a.querySelector('.vote-count').textContent);
        const voteCountB = parseInt(b.querySelector('.vote-count').textContent);

        if (sortBy === "oldest") {
          return timestampA - timestampB;
        } else if (sortBy === "newest") {
          return timestampB - timestampA;
        } else if (sortBy === "most-liked") {
          return voteCountB - voteCountA;
        }
      });

      replies.forEach((reply) => {
        section.appendChild(reply);
      });
    });
  }

  function showReportPopup(button) {
    const reportPopup = document.createElement('div');
    reportPopup.innerHTML = `
      <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ddd; border-radius: 4px; z-index: 1000;">
        <h3>Report Post</h3>
        <p>Are you sure you want to report this post?</p>
        <button onclick="submitReport()">Yes, Report</button>
        <button onclick="closeReportPopup()">Cancel</button>
      </div>
    `;
    document.body.appendChild(reportPopup);
  }

  function closeReportPopup() {
    const reportPopup = document.querySelector('body > div');
    if (reportPopup) {
      document.body.removeChild(reportPopup);
    }
  }

  function submitReport() {
    closeReportPopup();
    alert("Report submitted. Thank you!");
  }

  function addReply(button) {
    const replyInput = button.previousElementSibling;
    const replyContent = replyInput.value.trim();
    if (replyContent === "") return;

    const replySection = button.closest('.reply-section');
    const newReply = document.createElement('div');
    newReply.className = 'reply';
    newReply.dataset.timestamp = new Date().toISOString();
    newReply.innerHTML = `
      <div class="reply-header">
        <span class="author">You</span>
        <span class="timestamp">Just now</span>
      </div>
      <div class="reply-content">
        <p>${replyContent}</p>
      </div>
      <div class="reply-footer">
        <button onclick="vote(this, 1)">&#9650;</button>
        <div class="vote-count">0</div>
        <button onclick="vote(this, -1)">&#9660;</button>
        <div class="reply-actions">
          <button onclick="editReply(this)">Edit</button>
          <button onclick="deleteReply(this)">Delete</button>
          <button onclick="showReportPopup(this)">...</button>
        </div>
      </div>
    `;

    replySection.insertBefore(newReply, replySection.querySelector('.reply-input'));
    replyInput.value = "";
  }
  function makePost(post){
    return `
    <div class="post">
      <div class="post-voting">
        <button onclick="vote(this, 1)">&#9650;</button>
        <div class="vote-count">130</div>
        <button onclick="vote(this, -1)">&#9660;</button>
      </div>
      <div class="post-content">
        <h3>${post.title}</h3>
        <p>${post.contet}</p>
        <div class="post-footer">
          <span>Posted by <a href="profile.html">User1</a> in <a href="java.html">Java</a></span>
        </div>
       
        <button class="show-replies" onclick="toggleReplies(this)">Show Replies</button>
        <div class="reply-section" style="display:none;">
          <div class="sort-by">
            Sort by:
            <select onchange="sortReplies(this)">
              <option value="oldest">Oldest</option>
              <option value="newest">Newest</option>
              <option value="most-liked">Most Liked</option>
            </select>
          </div>
          <div class="reply" data-timestamp="2024-07-19T10:00:00">
            <div class="reply-header">
              <span class="author">User2</span>
              <span class="timestamp">2 days ago</span>
            </div>
            <div class="reply-content">
              <p>This post was really helpful! I never understood how to properly manage memory in Java until now. The examples provided were clear and easy to follow.</p>
            </div>
            <div class="reply-footer">
              <button onclick="vote(this, 1)">&#9650;</button>
              <div class="vote-count">85</div>
              <button onclick="vote(this, -1)">&#9660;</button>
              <div class="reply-actions">
               
                <button onclick="showReportPopup(this)">...</button>
              </div>
            </div>
          </div>
          <div class="reply" data-timestamp="2024-07-20T12:30:00">
            <div class="reply-header">
              <span class="author">User3</span>
              <span class="timestamp">1 day ago</span>
            </div>
            <div class="reply-content">
              <p>I had a lot of issues with memory leaks before. This post helped me understand how to use memory management techniques more effectively.</p>
            </div>
            <div class="reply-footer">
              <button onclick="vote(this, 1)">&#9650;</button>
              <div class="vote-count">60</div>
              <button onclick="vote(this, -1)">&#9660;</button>
              <div class="reply-actions">
                
                <button onclick="showReportPopup(this)">...</button>
              </div>
            </div>
          </div>
          <div class="reply-input">
            <textarea rows="3" placeholder="Add a reply..."></textarea>
            <button onclick="addReply(this)">Reply</button>
          </div>
        </div>
      </div>
    </div>
    `
  }
  // Read a page's GET URL variables and return them as an associative array.
  
  async function getPosts (){
    const poastsSection = document.getElementById('postsSection');

    const requestOptions = {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        };
                
    var url = '/api/auth/listThreads';
    var query = window.location.href.slice(window.location.href.indexOf('?')+1, 0);
    if(query.length>0){
      url += "?" + query
    } 
    console.log(url);
    const response = await fetch(url, requestOptions);
    const responseJson = await response.json();
    
    const posts = responseJson['records'];
    console.log(posts)
    posts.forEach(post=>{
      poastsSection.innerHTML += makePost(post);
    })
  }
  function editPost(button) {
    const postContent = button.closest('.post-content');
    const postText = postContent.querySelector('p');
    const editTextarea = document.createElement('textarea');
    editTextarea.rows = '3';
    editTextarea.value = postText.textContent;
    postContent.replaceChild(editTextarea, postText);
    button.textContent = "Save";
    button.onclick = () => savePost(button, editTextarea);
  }

  function savePost(button, editTextarea) {
    const postContent = button.closest('.post-content');
    const postText = document.createElement('p');
    postText.textContent = editTextarea.value;
    postContent.replaceChild(postText, editTextarea);
    button.textContent = "Edit";
    button.onclick = () => editPost(button);
  }

  function deletePost(button) {
    const post = button.closest('.post');
    post.parentNode.removeChild(post);
  }

  function editReply(button) {
    const replyContent = button.closest('.reply').querySelector('.reply-content p');
    const editTextarea = document.createElement('textarea');
    editTextarea.rows = '3';
    editTextarea.value = replyContent.textContent;
    const replyDiv = button.closest('.reply');
    replyDiv.replaceChild(editTextarea, replyContent);
    button.textContent = "Save";
    button.onclick = () => saveReply(button, editTextarea);
  }

  function saveReply(button, editTextarea) {
    const replyContent = document.createElement('p');
    replyContent.textContent = editTextarea.value;
    const replyDiv = button.closest('.reply');
    replyDiv.replaceChild(replyContent, editTextarea);
    button.textContent = "Edit";
    button.onclick = () => editReply(button);
  }

  function deleteReply(button) {
    const reply = button.closest('.reply');
    reply.parentNode.removeChild(reply);
  }
</script>

<footer>
  <div class="footer-container">
    <div class="footer-nav">
      <ul>
        <li><a href="about.html"><strong>About</strong></a></li>
        <li><a><strong>Email: CodeConnectSupport@gmail.com</strong></a></li>
        <li><a><strong>Phone: 888-888-8888</strong></a></li>
      </ul>
    </div>
    <div class="media-icons">
      <a href="#"><i class="fa-brands fa-instagram"></i></a>
      <a href="#"><i class="fa-brands fa-facebook"></i></a>
      <a href="#"><i class="fa-brands fa-google-plus"></i></a>
      <a href="#"><i class="fa-brands fa-youtube"></i></a>
    </div>
    <div class="footer-bott">
      <p>&copy; 2024 CodeConnect. All rights reserved.</p>
    </div>
  </div>
</footer>

</body>
</html>
