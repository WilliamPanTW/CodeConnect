<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/application/verticalPrototype/folder/frontend-css/signup.css">
    <title>CodeConnect Sign Up</title>
    <script>
      function validatePassword() {
        var password = document.getElementById("password").value;
        var confirmPassword = document.getElementById("confirm-password").value;
        var errorMessage = document.getElementById("error-message");
        var passwordPattern =
          /^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{8,}$/;

            if (!passwordPattern.test(password)) {
                errorMessage.textContent = "Password must be more than 8 letters and contain a number and a special character.";
                errorMessage.style.display = "block";
                return false;
            }

            if (password !== confirmPassword) {
                errorMessage.textContent = "Passwords do not match.";
                errorMessage.style.display = "block";
                return false;
            }
            
            errorMessage.style.display = "none";
            return true;
        }

        async function signUp(){
            var password = document.getElementById("password").value;
            var email = document.getElementById("email").value;
            var confirmPassword = document.getElementById("confirm-password").value;
            var errorMessage = document.getElementById("error-message");

            // if password is not strong enough or does not match
            if(!validatePassword()){
                return false;
            }
            try{
                // Try calling /api/auth/signup with email and password
                const requestOptions = {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ email: email, password: password })
                };
                
                // Catch Server Errors
                const response = await fetch("/api/auth/signup", requestOptions);

                // If fetch response code is not successfull
                if(!response.ok){
                    errorMessage.textContent = await response.json().message;
                    errorMessage.style.display = "block";
                    return false;
                }
                
                // Show the user that a verification email was sent
                errorMessage.textContent = "Please check your email inbox and verify it";
                errorMessage.style.display = "block";
                return true;
            }
            catch (error) {
                // Catch any unexpected error
                console.error("Failed at signing up user, Error: ", error);
                errorMessage.textContent = error;
                errorMessage.style.display = "block";
                return false;
            }
        }

    
      document.addEventListener("DOMContentLoaded", function() {

        var tosPanel = document.getElementById("tos-panel");
        var privacyPanel = document.getElementById("privacy-panel");

        var tosLink = document.querySelector(".tos-privacy a[href='#tos']");
        var privacyLink = document.querySelector(".tos-privacy a[href='#privacy']");

        var tosClose = document.querySelector("#tos-panel .close");
        var privacyClose = document.querySelector("#privacy-panel .close");

        // promps tos and provacy
        tosLink.onclick = function(event) {
          event.preventDefault();
          tosPanel.style.display = "block";
        }
        privacyLink.onclick = function(event) {
          event.preventDefault();
          privacyPanel.style.display = "block";
        }

        tosClose.onclick = function() {
          tosPanel.style.display = "none";
        }
        privacyClose.onclick = function() {
          privacyPanel.style.display = "none";
        }
      });
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="header">
      <img src="Logo.jpg" alt="Logo" class="logo" />
      <div class="brand">CodeConnect</div>
      <div class="login-signup">
        <a href="login.html">Login</a>
        <a href="signup.html">Sign Up</a>
      </div>
      <h2>Sign Up</h2>
    </div>
    <div class="signup-container">
      <img src="Logo.jpg" alt="Logo" />
      <h1>CodeConnect</h1>
      <h3>Start Your Tech Journey With Us.</h3>
      <input type="text" placeholder="Username" />
      <input type="email" id="email" placeholder="Email Address" />
      <input type="password" id="password" placeholder="Password" />
      <input type="password" id="confirm-password" placeholder="Confirm Password" />
      <div id="error-message" class="error-message"></div>
      <div class="tos-privacy">
        <input type="checkbox" id="tos-checkbox" />
        <label for="tos-checkbox">You agree to the <a href="#tos">terms of use</a> and acknowledge the <a href="#privacy">privacy policy</a>.</label>
      </div>
      <button onclick="return signUp();">Sign Up</button>
      <div class="links">
        <p>Have an account?</p>
        <a href="./login.html">Sign In</a>
      </div>
    </div>

    <div id="tos-panel" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Terms of Service</h2>
        <p>Codeconnect terms of service</p>
      </div>
    </div>

    <div id="privacy-panel" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Privacy Policy</h2>
        <p>Codeconnect privacy policy</p>
      </div>
    </div>
    <footer>
      <div class="footer-container">
        <div class="footer-nav">
          <ul>
            <li>
              <a href="index.html"><strong>Home</strong></a>
            </li>
            <li>
              <a href="about.html"><strong>About</strong></a>
            </li>
            <li>
              <a><strong>Email: CodeConnectSupport@gmail.com</strong></a>
            </li>
            <li>
              <a><strong>Phone: 888-888-8888</strong></a>
            </li>
          </ul>
        </div>
        <div class="media-icons">
          <a href="https://www.instagram.com/codeconnect"><i class="fa-brands fa-instagram"></i></a>
          <a href="https://www.facebook.com/codeconnect"><i class="fa-brands fa-facebook"></i></a>
          <a href="https://www.google.com/codeconnect"><i class="fa-brands fa-google-plus"></i></a>
          <a href="https://www.youtube.com/codeconnect"><i class="fa-brands fa-youtube"></i></a>
        </div>
        <div class="footer-bott">
          <p>&copy; 2024 CodeConnect. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
